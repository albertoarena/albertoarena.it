---
import Layout from "../components/Layout.astro";
import { getCollection } from "astro:content";
import PostCard from "../components/PostCard.astro";
import Pagination from "../components/Pagination.astro";
import { siteConfig } from "../utils/config";

const posts = await getCollection("posts");
const sortedPosts = posts
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const { postsLimit } = siteConfig;
const totalPages = Math.ceil(sortedPosts.length / postsLimit);
const pagePosts = sortedPosts.slice(0, postsLimit);
---

<Layout title={siteConfig.title} isIndex={true}>
	<section class="mb-12 pb-8 border-b border-white-cloud dark:border-dark-cloud">
		<p class="text-lg text-gray leading-relaxed">
			Thoughts on software engineering, architecture patterns, and the tools I build.
		</p>
	</section>

	<div class="space-y-10 animate-stagger">
		{pagePosts.map((post) => <PostCard post={post} />)}
	</div>

	<Pagination currentPage={1} totalPages={totalPages} />
</Layout>