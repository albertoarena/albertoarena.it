---
import { getCollection } from "astro:content";
import Layout from "../../components/Layout.astro";
import PostCard from "../../components/PostCard.astro";

export async function getStaticPaths() {
    const posts = await getCollection("posts");
    const allTags = posts.flatMap((post) => post.data.tags || []);
    const uniqueTags = [...new Set(allTags)];

    return uniqueTags.map((tag) => ({
        params: { tag: tag.toLowerCase().replace(/\s+/g, '-') },
        props: {
            tag,
            posts: posts
                .filter((post) => post.data.tags?.includes(tag) && !post.data.draft)
                .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
        },
    }));
}

const { tag, posts } = Astro.props;
---

<Layout title={`Tag: ${tag}`}>
    <h1 class="text-3xl font-bold mb-4">
        Tag: <span class="text-secondary">{tag}</span>
    </h1>
    <p class="text-gray-600 dark:text-gray-400 mb-8">
        {posts.length} {posts.length === 1 ? 'post' : 'posts'} with this tag
    </p>
    <div class="space-y-10">
        {posts.map((post) => <PostCard post={post} />)}
    </div>
</Layout>
